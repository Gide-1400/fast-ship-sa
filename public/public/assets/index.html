<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - المرسل | FastShip</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/custom.css">
    <script src="/config/supabase.js"></script>
    <script src="/assets/js/session-manager.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-r from-blue-500 to-purple-600">
    <div class="container mx-auto p-6">
        <!-- Header -->
        <div class="glass-card p-6 mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-white">لوحة تحكم المرسل</h1>
                    <p class="text-white/80">إدارة شحناتك والبحث عن أفضل الناقلين</p>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sign-out-alt ml-2"></i>تسجيل الخروج
                    </button>
                    <button onclick="goToProfile()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-user ml-2"></i>الملف الشخصي
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div class="glass-card p-6 stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-300 text-sm">الشحنات النشطة</p>
                        <p class="text-3xl font-bold text-white">5</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-500 bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="fas fa-box text-blue-300 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="glass-card p-6 stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-300 text-sm">الشحنات المكتملة</p>
                        <p class="text-3xl font-bold text-white">23</p>
                    </div>
                    <div class="w-12 h-12 bg-green-500 bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="fas fa-check-circle text-green-300 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="glass-card p-6 stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-300 text-sm">الرسائل الجديدة</p>
                        <p class="text-3xl font-bold text-white">3</p>
                    </div>
                    <div class="w-12 h-12 bg-yellow-500 bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="fas fa-envelope text-yellow-300 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="glass-card p-6 stat-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-300 text-sm">التوفير الإجمالي</p>
                        <p class="text-3xl font-bold text-white">$1,250</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-500 bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="fas fa-dollar-sign text-purple-300 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Quick Actions -->
            <div class="glass-card p-6">
                <h2 class="text-xl font-bold text-white mb-6">إجراءات سريعة</h2>
                <div class="space-y-4">
                    <button onclick="addShipment()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold transition-all transform hover:scale-105">
                        <i class="fas fa-plus ml-2"></i>إضافة شحنة جديدة
                    </button>
                    <button onclick="smartMatch()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-semibold transition-all transform hover:scale-105">
                        <i class="fas fa-magic ml-2"></i>البحث الذكي عن ناقل
                    </button>
                    <button onclick="openMessages()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 px-4 rounded-lg font-semibold transition-all transform hover:scale-105">
                        <i class="fas fa-comments ml-2"></i>الرسائل والإشعارات
                        <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full mr-2">3</span>
                    </button>
                </div>
            </div>

            <!-- Recent Shipments -->
            <div class="glass-card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-white">الشحنات الأخيرة</h2>
                    <button class="text-blue-200 hover:text-white">عرض الكل</button>
                </div>
                <div class="space-y-4">
                    <div class="bg-white bg-opacity-5 p-4 rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="text-white font-medium">إلكترونيات - الرياض إلى جدة</h3>
                                <p class="text-gray-300 text-sm">الوزن: 25 كيلو</p>
                            </div>
                            <span class="bg-yellow-500 text-black text-xs px-2 py-1 rounded-full">في انتظار ناقل</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <p class="text-gray-400 text-sm">25 أكتوبر 2024</p>
                            <p class="text-green-300 font-semibold">$75</p>
                        </div>
                    </div>

                    <div class="bg-white bg-opacity-5 p-4 rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="text-white font-medium">مستندات - الدمام إلى الرياض</h3>
                                <p class="text-gray-300 text-sm">الوزن: 2 كيلو</p>
                            </div>
                            <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full">في الطريق</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <p class="text-gray-400 text-sm">23 أكتوبر 2024</p>
                            <p class="text-green-300 font-semibold">$35</p>
                        </div>
                    </div>

                    <div class="bg-white bg-opacity-5 p-4 rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="text-white font-medium">ملابس - مكة إلى الطائف</h3>
                                <p class="text-gray-300 text-sm">الوزن: 15 كيلو</p>
                            </div>
                            <span class="bg-green-500 text-white text-xs px-2 py-1 rounded-full">مكتمل</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <p class="text-gray-400 text-sm">20 أكتوبر 2024</p>
                            <p class="text-green-300 font-semibold">$45</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Available Carriers -->
        <div class="glass-card p-6 mt-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">الناقلون المتاحون</h2>
                <button onclick="refreshCarriers()" class="text-blue-300 hover:text-blue-200">
                    <i class="fas fa-refresh ml-1"></i>تحديث
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="bg-white bg-opacity-5 p-4 rounded-lg">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-truck text-white"></i>
                        </div>
                        <div class="mr-3">
                            <h3 class="text-white font-medium">أحمد النقل السريع</h3>
                            <div class="flex text-yellow-400 text-sm">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                            <span class="text-gray-300 text-sm mr-2">(4.9)</span>
                        </div>
                    </div>
                    <p class="text-gray-300 text-sm mb-3">متخصص في النقل السريع والآمن</p>
                    <div class="flex justify-between items-center">
                        <span class="text-green-300 font-semibold">متاح الآن</span>
                        <button onclick="contactCarrier('ahmed')" class="bg-blue-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-600 transition-colors">
                            تواصل
                        </button>
                    </div>
                </div>

                <div class="bg-white bg-opacity-5 p-4 rounded-lg">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-shipping-fast text-white"></i>
                        </div>
                        <div class="mr-3">
                            <h3 class="text-white font-medium">شركة الوصول للشحن</h3>
                            <div class="flex text-yellow-400 text-sm">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="far fa-star"></i>
                            </div>
                            <span class="text-gray-300 text-sm mr-2">(4.7)</span>
                        </div>
                    </div>
                    <p class="text-gray-300 text-sm mb-3">خدمة شحن موثوقة بأسعار تنافسية</p>
                    <div class="flex justify-between items-center">
                        <span class="text-yellow-300 font-semibold">مشغول حتى غداً</span>
                        <button onclick="contactCarrier('wasool')" class="bg-gray-500 text-white px-3 py-1 rounded-lg text-sm">
                            احجز
                        </button>
                    </div>
                </div>

                <div class="bg-white bg-opacity-5 p-4 rounded-lg">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-truck-fast text-white"></i>
                        </div>
                        <div class="mr-3">
                            <h3 class="text-white font-medium">سرعة البرق للنقل</h3>
                            <div class="flex text-yellow-400 text-sm">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </div>
                            <span class="text-gray-300 text-sm mr-2">(5.0)</span>
                        </div>
                    </div>
                    <p class="text-gray-300 text-sm mb-3">أسرع خدمة توصيل في المملكة</p>
                    <div class="flex justify-between items-center">
                        <span class="text-green-300 font-semibold">متاح الآن</span>
                        <button onclick="contactCarrier('lightning')" class="bg-blue-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-600 transition-colors">
                            تواصل
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // حماية الصفحة: فقط الشاحن يدخل
        document.addEventListener('DOMContentLoaded', async function() {
            await window.sessionManager.init();
            const user = window.sessionManager.getCurrentUser();
            if (!user || (user.profile?.user_type !== 'shipper')) {
                alert('هذه الصفحة مخصصة لأصحاب الشحنات فقط');
                window.sessionManager.goToDashboard();
                return;
            }
            // يمكن هنا إضافة أي منطق إضافي بعد التأكد من نوع المستخدم
            console.log('✅ User authenticated as shipper:', user.email);
        });

        function addShipment() {
            window.location.href = '/assets/add-shipment.html';
        }

        function smartMatch() {
            alert('جاري البحث الذكي عن أفضل ناقل لشحنتك...');
        }

        function openMessages() {
            alert('نظام الرسائل والإشعارات قيد التطوير');
        }

        function logout() {
            if (confirm('هل تريد تسجيل الخروج؟')) {
                localStorage.removeItem('fastship_user');
                sessionStorage.removeItem('fastship_user');
                window.location.href = '/index.html';
            }
        }

        function goToProfile() {
            window.location.href = '/pages/profile.html';
        }

        function contactCarrier(carrierId) {
            alert(`جاري فتح محادثة مع الناقل ${carrierId}...`);
        }

        function refreshCarriers() {
            alert('جاري تحديث قائمة الناقلين المتاحين...');
            // Simulate refresh
            setTimeout(() => {
                location.reload();
            }, 1000);
        }
    </script>
</body>
</html>