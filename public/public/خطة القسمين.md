# خطة فصل واجهة الناقل وواجهة الشاحن (خطة القسمين)

## 1. هيكل المجلدات المقترح

```
public/
  carrier-app/
    index.html           # لوحة تحكم الناقل (الرئيسية)
    login.html           # تسجيل دخول الناقل
    register.html        # تسجيل ناقل جديد
    dashboard.html       # لوحة تحكم الناقل
    add-trip.html        # إضافة رحلة جديدة
    trips.html           # قائمة الرحلات الخاصة به
    messages.html        # رسائل الناقل
    notifications.html   # تنبيهات الناقل
    assets/              # ملفات CSS/JS خاصة بالناقل
  shipper-app/
    index.html           # لوحة تحكم الشاحن (الرئيسية)
    login.html           # تسجيل دخول الشاحن
    register.html        # تسجيل شاحن جديد
    dashboard.html       # لوحة تحكم الشاحن
    add-shipment.html    # إضافة شحنة جديدة
    shipments.html       # قائمة الشحنات الخاصة به
    messages.html        # رسائل الشاحن
    notifications.html   # تنبيهات الشاحن
    assets/              # ملفات CSS/JS خاصة بالشاحن
  shared/
    js/
      supabase.js        # تهيئة Supabase مشترك
      messaging.js       # منطق الرسائل والتنبيهات مشترك
      utils.js           # دوال مساعدة مشتركة
    css/
      main.css           # ستايل مشترك
  resources/
    ...                  # صور وأيقونات مشتركة
```

---

## 2. منطق التوجيه والدخول
- كل موقع له صفحة تسجيل دخول وتسجيل خاصة به (carrier-app/login.html و shipper-app/login.html).
- بعد تسجيل الدخول، كل مستخدم يبقى في موقعه ولا يرى صفحات الطرف الآخر.
- حماية الصفحات تتم عبر sessionManager خاص بكل تطبيق، ويتحقق من user_type قبل عرض أي صفحة.

---

## 3. قاعدة البيانات (Supabase)
- جدول users: يحوي user_type (carrier/shipper) ويخدم كلا الموقعين.
- جدول trips: الرحلات، يراها الناقلون ويمكن للشاحن البحث فيها.
- جدول shipments: الشحنات، يراها الشاحنون ويمكن للناقل البحث فيها.
- جدول messages: الرسائل بين أي مستخدمين (carrier ↔ shipper).
- جدول notifications: تنبيهات موجهة حسب user_id.

---

## 4. الربط بين الموقعين
- الرسائل: messaging.js في shared/js يستدعي رسائل المستخدم من جدول messages حسب user_id للطرفين.
- التنبيهات: notifications.js في shared/js تعرض تنبيهات المستخدم من جدول notifications.
- المطابقة الذكية: كل تطبيق يستدعي دوال البحث/المطابقة من نفس قاعدة البيانات (trips ↔ shipments).

---

## 5. مزايا هذا الهيكل
- كل واجهة بسيطة وواضحة للمستخدم (لا يرى إلا ما يخصه).
- لا يوجد تعارض في التوجيه أو حماية الصفحات.
- أي منطق مشترك (رسائل، تنبيهات، دوال مساعدة) يوضع في shared ويستدعى من كلا الموقعين.
- سهولة التطوير والصيانة، وأي تعديل في واجهة لا يؤثر على الأخرى.

---

## 6. خطوات التنفيذ
1. نسخ صفحات كل نوع مستخدم إلى مجلد خاص به carrier-app و shipper-app.
2. نقل ملفات الجافاسكريبت والستايل المشترك إلى shared.
3. تحديث جميع الروابط الداخلية لتكون نسبية داخل كل تطبيق.
4. تحديث sessionManager في كل تطبيق ليتحقق من user_type المناسب فقط.
5. اختبار كل تطبيق بشكل مستقل.
6. التأكد من أن الرسائل والتنبيهات والمطابقة تعمل عبر shared/js.

---

---

## توصية التنفيذ العملية

1. **ابدأ أولاً بقسم الشاحن (shipper):**
  - ركز على إكمال وتطوير جميع صفحات الشاحن (لوحة التحكم، إضافة شحنة، الرسائل، التنبيهات...)
  - اختبر كل السيناريوهات حتى تتأكد أن كل شيء يعمل بسلاسة.

2. **بعد نجاح قسم الشاحن بالكامل:**
  - انسخ مجلد المشروع وخصصه لقسم الناقل (carrier).
  - عدل الصفحات والمنطق ليخدم الناقل فقط.
  - أضف أو طور ما ينقصه من صفحات أو وظائف.

3. **اجعل الملفات المشتركة (supabase.js، messaging.js، إلخ) في shared ليستفيد منها القسمان.**

4. **بعد فصل القسمين:**
  - كل قسم له حماية وتجربة مستخدم مستقلة.
  - لا يمكن لأي مستخدم الدخول على القسم الآخر.
  - التطوير والصيانة أسهل وأوضح.

ابدأ الآن بقسم الشاحن، وبعد نجاحه انتقل للناقل بنفس النمط.